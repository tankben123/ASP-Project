<!-- Styles -->
@model List<int>
<style>
    #chartdiv {
      width: 100%;
      height: 550px;
    }
</style>

<!-- Resources -->
@section Scripts
{
    <script src="https://cdn.amcharts.com/lib/5/index.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/hierarchy.js"></script>
    <script src="https://cdn.amcharts.com/lib/5/themes/Animated.js"></script>

    <!-- Chart code -->
    <script>
        am5.ready(function() {

        // Create root element
        // https://www.amcharts.com/docs/v5/getting-started/#Root_element
        var root = am5.Root.new("chartdiv");

        // Set themes
        // https://www.amcharts.com/docs/v5/concepts/themes/
        root.setThemes([
          am5themes_Animated.new(root)
        ]);

        var data = {
          name: "Root",
          value: 0,
          // children: [
          //   {
          //     name: "A",
          //     value: 6,
          //     linkWith: ["C", "M", "L", "Q"],
          //   },
          //   {
          //     name: "B",
          //     value: 6,
          //     linkWith: ["C", "D", "N", "E"],
          //   },
          //   {
          //     name: "C",
          //     linkWith: ["A", "B"],
          //   },
          //   {
          //     name: "N",
          //     linkWith: ["A", "B"],
          //   },
          //   {
          //     name: "D",
          //     linkWith: ["B"],
          //   },
          //   {
          //     name: "E",
          //     linkWith: ["B"],
          //   },
          //   {
          //     name: "Q",
          //     linkWith: ["A"],
          //   },
          //   {
          //     name: "M",
          //     linkWith: ["A"],
          //   },
          // ]
        };

        // Create wrapper container
        var container = root.container.children.push(
          am5.Container.new(root, {
            width: am5.percent(100),
            height: am5.percent(100),
            layout: root.verticalLayout
          })
        );

        // Create series
        // https://www.amcharts.com/docs/v5/charts/hierarchy/#Adding
        var series = container.children.push(
          am5hierarchy.ForceDirected.new(root, {
            singleBranchOnly: false,
            downDepth: 1,
            topDepth: 1,
            maxRadius: 25,
            minRadius: 12,
            valueField: "value",
            categoryField: "firstName",
            childDataField: "children",
            idField: "id",
            linkWithStrength: 0.3,
            linkWithField: "linkWith",
            manyBodyStrength: -15,
            centerStrength: 0.5
          })
        );

        series.get("colors").set("step", 2);

        series.data.setAll([data]);
        series.set("selectedDataItem", series.dataItems[0]);

        // Make stuff animate on load
        series.appear(1000, 100);


        $.post("/employee/network", {ids:@System.Text.Json.JsonSerializer.Serialize(Model)}, (d)=> {
            console.log(d);
            data["children"] = d;
            series.nodes.template.set("tooltipText", "Name: {firstName} {lastName}\nEmail: {email}\nPhone: {phone}");
            series.nodes.template.events.on('click', function(ev) {
                var o = ev.target.dataItem.dataContext;
                $('#rs').html(`<table>
                    <tbody>
                        <tr>
                            <th>First Name</th>
                            <td>${o.firstName}</td>
                        </tr>

                        <tr>
                            <th>Last Name</th>
                            <td>${o.lastName}</td>
                        </tr>

                        <tr>
                            <th>email</th>
                            <td>${o.email}</td>
                        </tr>

                        <tr>
                            <th>Phone</th>
                            <td>${o.phone}</td>
                        </tr>

                    </tbody>
                </table>`);
                $('#exampleModal').modal('show');
            });
            series.data.setAll([data]);
            series.set("selectedDataItem", series.dataItems[0]);

            // Make stuff animate on load
            series.appear(1000, 100);
        });

        }); // end am5.ready()
    </script>
}

<!-- HTML -->
<div id="chartdiv"></div>

<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Modal title</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="rs">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>